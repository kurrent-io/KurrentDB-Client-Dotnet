sequenceDiagram
    actor Client
    participant SchemaSerializer
    participant TypeMapper
    participant PolicyResolver
    participant SchemaRegistry

    Client ->> SchemaSerializer: Deserialize(data, context)

    Note over SchemaSerializer: Extract schema info from metadata

    SchemaSerializer ->> TypeMapper: GetOrResolveMessageType(schemaName)
    TypeMapper -->> SchemaSerializer: Resolved .NET type

    SchemaSerializer ->> PolicyResolver: Resolve policy requirements
    PolicyResolver -->> SchemaSerializer: Resolved policy

    alt Policy.ValidateSchemas = true
        alt Schema has version ID
            SchemaSerializer ->> SchemaRegistry: EnsureSchemaCompatibility(versionId, type)
            SchemaRegistry -->> SchemaSerializer: Validation result
        else Schema has only name
            SchemaSerializer ->> SchemaRegistry: EnsureSchemaCompatibility(name, type)
            SchemaRegistry -->> SchemaSerializer: Validation result + versionId
            Note over SchemaSerializer: Update metadata with versionId
        end
    end

    Note over SchemaSerializer: Format-specific deserialization using Deserialize(data, resolvedType)

    SchemaSerializer -->> Client: Return deserialized object
