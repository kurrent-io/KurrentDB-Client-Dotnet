syntax = "proto3";

package kurrentdb.protocol;

option csharp_namespace    = "KurrentDB.Protocol";
option java_package        = "io.kurrentdb.protocol";
option java_multiple_files = true;

import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/descriptor.proto";

//===================================================================
// Dynamic values
//===================================================================

// Represents a list of dynamically typed values.
message DynamicValueList {
  // Repeated property of dynamically typed values.
  repeated DynamicValue values = 1;
}

// Represents a map of dynamically typed values.
message DynamicValueMap {
  // A map of string keys to dynamically typed values.
  map<string, DynamicValue> values = 1;
}

// Represents a dynamic value
message DynamicValue {
  oneof kind {
    // Represents a null value.
    google.protobuf.NullValue null_value = 1;
    // Represents a 32-bit signed integer value.
    sint32 int32_value = 2;
    // Represents a 64-bit signed integer value.
    sint64 int64_value = 3;
    // Represents a byte array value.
    bytes bytes_value = 4;
    // Represents a 64-bit double-precision floating-point value.
    double double_value = 5;
    // Represents a 32-bit single-precision floating-point value
    float float_value = 6;
    // Represents a string value.
    string string_value = 7;
    // Represents a boolean value.
    bool boolean_value = 8;
    // Represents a timestamp value.
    google.protobuf.Timestamp timestamp_value = 9;
    // Represents a duration value.
    google.protobuf.Duration duration_value = 10;
  }
}

//===================================================================
// Error Annotations
//===================================================================

message ErrorAnnotations {
  // Identifies the error condition.
  string code = 1;

  // Severity of the error.
  Severity severity = 2;

  // Human-readable message that describes the error condition.
  optional string message = 3;

  enum Severity {
    // The error is recoverable, the operation failed but the session can continue.
    RECOVERABLE = 0;
    // The error is fatal and the session should be terminated.
    FATAL = 1;
    // The error is retriable, the operation failed but can be retried.
    RETRIABLE = 2;
  }
}

// Extend the MessageOptions to include error information.
extend google.protobuf.MessageOptions {
  // Provides additional information about the error condition.
  optional ErrorAnnotations error_info = 50000;
}

//===================================================================
// Error Details
//===================================================================

// Provides detailed information about specific error conditions.
message CoreErrorDetails {
  message AccessDenied {
    option (error_info) = {
      code: "ACCESS_DENIED",
      severity: RECOVERABLE,
      message: "The user does not have sufficient permissions to perform the operation. Please check your permissions and try again."
    };
  }

  message DeadlineExceeded {
    option (error_info) = {
      code: "DEADLINE_EXCEEDED",
      severity: RECOVERABLE,
      message: "The operation has timed out and exceeded the deadline. Please try again later."
    };
  }

  message Unauthenticated {
    option (error_info) = {
      code: "UNAUTHENTICATED",
      severity: RECOVERABLE,
      message: "The user is not authenticated. Please provide valid authentication credentials."
    };
  }

  message NotFound {
    option (error_info) = {
      code: "NOT_FOUND",
      severity: RECOVERABLE,
      message: "The specified entity was not found. Please check its identifier and try again."
    };
  }

  message AlreadyExists {
    option (error_info) = {
      code: "ALREADY_EXISTS",
      severity: RECOVERABLE,
      message: "The specified entity already exists."
    };
  }

  message FailedPrecondition {
    option (error_info) = {
      code: "FAILED_PRECONDITION",
      severity: RECOVERABLE,
      message: "The operation cannot be performed in the current state. Please check the preconditions and try again."
    };
  }

  // For internal usage
  message Unknown {
    option (error_info) = {
      code: "UNKNOWN",
      severity: RECOVERABLE,
      message: "An unknown error occurred."
    };
  }
}
